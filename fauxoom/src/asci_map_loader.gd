extends Node
class_name AsciMapLoader

const asci0:String = """#####
#. .#
# s #
#. .#
#####
"""

const asci1:String = """#
s
.
"""

const asci2:String = """########################################x  ......###############
######################################     ......###############
##########################...#### x ##x    .......##############
###################...####...####        x .###....  x  ########
###################....###......           .###....     ########
###################...####....  x   x   x  .##  x       ########
###########.....###...####....          x      x      ##########
###########.....###...###.....                        ##########
###########.....###....#.......          x    x  x . ..#########
############....###............ . k  x  .  x    x  . ..#########
############................... ..  ##x            .   #########
############................... ..####   x ....#x  . x #########
############.......#........... ..###..   ......   x   #########
#############....###..........k ..###.............. # ##########
############# x .####...#..... x..###...##......    # ##########
#############x xx       x  x x              x  x    #s##########
#############     .#######.   x .######...#.####x  .############
##############x     ######.  x. ######....#.####################
###############    x     #.x  .   #####.....####################
##################             x  ##############################
##################       x   .. #e##############################
################    #  x      .x################################
################              . #...############################
################       # x    .x#...############################
####################  x#  xx     ...############################
#####################   x    x   ...############################
#####################          x ...############################
#################### x  x          #############################
#################### x           x #############################
####################         #x    #############################
####################        x###################################
######################   #######################################
"""

const asci3:String = """################################################################
#################...###...######################################
#################...#.......####################################
#################.................#########################...##
#################...#...#.........#########################....#
#################....####...x  ...################...###.......#
##################...##...##x   .#################.............#
##################........#     .#################...###..   ..#
#######################...#  x. ##################.   #      ..#
###########################   . ..#############....     x    ..#
############################x#. xx#############....   #x     ###
############################ x    #############...   ....# xx  #
#########..#################    x  ############...   ....#   x #
######x x..#####   ##########      ############...   ....#   x##
######    ....      xxx########  x ############..     ###   ####
######    ..   x      x            x           x  x   ..#x######
#######x  ..    x ###   ####### ###############       ..# ######
#######           ###     x####   ############ex  ###x..# ######
#######...## ##   ######     ## # ############ x ####     ######
#######...# x    x######     ## # ###################     ######
########.#.    x x  ######   ## # ####################   #######
########...   xxx   ####### x #x#x  ############################
#######......##     #######   # ##  ###...##...#################
#####.......###     ##k         ##  #     .....#################
#####......####     #####             s   ......################
#####...#..#####      ### xx  x      .. x ........###########.##
####....#...####      ####     x     ...#####.....##...######.##
####....###....     xx       x.. .x  ##########....#...######.##
####..###......   # x ###        ## ##############.....###....##
#########......    k#####  x     x   #############.....###....##
#########...#############  x       x ##############..........###
################################################################
"""

const asci4:String = """x  ...
..  ..
...  s
"""

static func get_default() -> String:
	# var str:String = asci3
	test_base64()
	#return asci0
	return asci4
	#return asci3
	#return asci2
	#return asci1

static func str_to_b64(source:String) -> String:
	var srcBytes:PoolByteArray = source.to_utf8()
	var compressed = srcBytes.compress()
	var b64:String = Marshalls.raw_to_base64(compressed)
	return b64

static func b64_to_str(source:PoolByteArray) -> String:
	return ""

static func test_base64() -> String:
	# b64 encodes 6 bits per char
	var source:String = asci3
#	print("Source chars: " + str(source.length()))
#	var srcBytes:PoolByteArray = source.to_utf8()
#	var compressed = srcBytes.compress()
#	print("String bytes " + str(srcBytes.size()) + " compressed bytes: " + str(compressed.size()))
#	var b64:String = Marshalls.raw_to_base64(compressed)
	var b64 = str_to_b64(source)
	print("b64 chars: " + str(b64.length()))
	return b64

static func _measure_line(txt:String) -> int:
	var i:int = 0
	var c = txt[i]
	while c != '\n' && c != '\r':
		i += 1
		c = txt[i]
	return i

static func read_string(txt:String) -> Dictionary:
	print("Asci map loader - read string len " + str(txt.length()))
	txt = txt.replace("\r", "")
	var lines:PoolStringArray = txt.split("\n", false)
	var longest:int = 0
	for i in range (0, lines.size()):
		var length = lines[i].length()
		if length > longest:
			longest = length
	return {
		width = longest,
		height = lines.size(),
		lines = lines
	}
